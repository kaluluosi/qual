# 2023年9月21日

## 用户的创建应该在什么时候做？

很多网站的用户创建和认证登录其实是两套流程。

用户创建是用户创建，认证是认证。

梳理一下流程：

1. XYSSO认证获得 `code`
2. 你就能够用这个`code`来请求用户信息。 
3. 如果数据库用户不存在就用这个用户信息来创建用户
4. 接着用这个 `code` 来认证获取 `token`。

这四个流程应该对应4个接口，其中1、2、4是 xysso模块的接口，3是用户模块的接口。

一些网站的过程3时无感知的，因为他前端后台请求处理了，没有展示给用户。

XXX: 基于上面的认知，用户创建不应该在 `/xysso/token` 中实现？目前还是不清楚，先耦合进去实现吧，之后再看。

还有一个事情， `code` 是sso页面认证后重定向一次性获取的。而且 `code` 也是一次性的，也就是说无法用一个 `code` 请求两次。
上面的流程想要前端用这个 `code` 去请求用户信息，请求用户创建，然后再拿`code`请求`token`。这个流程是做不到的，因为`code`是一次性的，第一次请求用户信息的时候就已经失效了。

因此用户的创建和`token`的获取流程只能在一个`code`的流程里解决。·